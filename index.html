<!DOCTYPE html>
  <head>
    <title>Breakout</title>
    <link type="css/text" href="css/styles.css" rel="stylesheet">
  </head>
  <body>
    <div id="wrapper">
      <canvas id="canvas" width="300px" height="300px"></canvas>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="js/breakout.js"></script>
    <script>
      var canvasMinX;
      var canvasMaxX;
      var bricks;
      var rows;
      var cols;
      var brickWidth;
      var brickHeight;
      var padding;

      function init_bricks() {
        rows = 5;
        cols = 5;
        brickWidth = (width/cols) - 1;
        brickHeight = 15;
        padding = 1;

        bricks = new Array(rows);
        for (i=0; i < rows; i++) {
          bricks[i] = new Array(cols);
          for (j=0; j < cols; j++) {
            bricks[i][j] = 1;
          }
        }
      }

      function init_mouse() {
        canvasMinX = $("#canvas").offset().left;
        canvasMaxX = canvasMinX + width;
      }

      function onMouseMove(evt) {
        if (evt.pageX > canvasMinX && evt.pageX < canvasMaxX) {
          paddlex = evt.pageX - canvasMinX - paddlew/2;
        }
      }

      $(document).mousemove(onMouseMove);

      function draw() {
        clear();
        circle(x, y, 10);

        rect(paddlex, height-paddleh, paddlew, paddleh);

        //draw bricks
        for (i=0; i < rows; i++) {
          for (j=0; j < cols; j++) {
            if (bricks[i][j] == 1) {
              rect((j * (brickWidth + padding)) + padding,
                   (i * (brickHeight + padding)) + padding,
                   brickWidth, brickHeight);
            }
          }
        }

        //have we hit a brick?
        rowheight = brickHeight + padding;
        colwidth = brickWidth + padding;
        row = Math.floor(y/rowheight);
        col = Math.floor(x/colwidth);
        //if so, reverse the ball and mark the brick as broken
        if (y < rows * rowheight && row >= 0 && col >= 0 && bricks[row][col] == 1) {
          dy = -dy;
          bricks[row][col] = 0;
        }

        if (x + dx > width || x + dx < 0)
          dx = -dx;

        if (y + dy < 0)
          dy = -dy;
        else if (y + dy > height) {
          if (x > paddlex && x < paddlex + paddlew)
            dy = -dy;
          else
            clearInterval(intervalId);
        }

        x += dx;
        y += dy;
      }

      init();
      init_mouse();
      init_bricks();
    </script>
  </body>
</html>
